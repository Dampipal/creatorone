import { streamText } from "ai";
import { google } from "@ai-sdk/google";

export const runtime = "edge";

export async function POST(req: Request) {
  const { topic } = await req.json();

  const result = await streamText({
    model: google("gemini-2.5-flash"),
    temperature: 0.8,

    prompt: `
You are a viral short video script writer for Indian audience.

You must write in Hinglish + Hindi style like the examples below.

====================
WRITING STYLE EXAMPLES:

Example 1:
क्यों एरोप्लेंस में इंडिया से अमेरिका जाने के लिए आपको नॉर्थ पोल को छूते हुए गुजरना पड़ता है जबकि सीधा रास्ता तो यह है क्यों सभी एरोप्लेंस एक लंबा कर्वड रास्ता चुनते हैं जबकि वह सीधे पॉइंट ए से b तक एक स्ट्रेट लाइन में भी तो उड़ सकते हैं वेल अर्थ बेसिकली एक 3d स्फीयर है जो कि सेंटर में सबसे ज्यादा चौड़ा है और नरो टुवर्ड्स द पोल्स अब एयरलाइंस एक इंटरेस्टिंग कांसेप्ट यूज़ करते हैं जो उन्हें हमेशा दो जगहों के बीच में कम से कम डिस्टेंस को फिगर आउट करने में हेल्प करता है इस कांसेप्ट को कहते हैं द ग्रेट सर्कल कांसेप्ट सो किसी भी फ्लैट सरफेस में पॉइंट ए से पॉइंट बी जाने का शॉर्टेस्ट पाथ होता है एक स्ट्रेट लाइन बट एक सर्कुलर सरफेस में शॉर्टेस्ट पैथ हमेशा होता है द ग्रेट सर्किल जो बेसिकली अर्थ को दो इक्वल भागों में बांटता है और सरकंफ्रेंस इतना लंबा होता है अब जरा अपनी आंखों के सामने एक मैजिक देखिए दिल्ली से न्यूयॉर्क अगर आप ग्रेड सर्कल मॉडल यूज करके जाते हो या फिर कॉमन सेंस यूज करके स्ट्रेट लाइन में जाते हो तो इसमें जो कर्वड रास्ता है जो दिखने में लंबा लग रहा है वो रियलिटी में शॉर्टकट निकलता है यानी कि एयरलाइन कंपनीज के लिए फ्यूल्स की बचत और मोटा मुनाफा अपने ज्ञान के तारों को इसी तरह लंबा करने के लिए फॉलो फॉर मो
(Use same storytelling + flow + curiosity tone)

Example 2:
प्लास्टिक के बोतल में पानी तो हर कोई
पीता है। राइट? कोलंबिया यूनिवर्सिटी और
नेशनल इंस्टट्यूट ऑफ हेल्थ के एक रिसर्च
में 1 लीटर पानी के प्लास्टिक बोतल में ऑन
एन एवरेज 2.4 लाख प्लास्टिक पार्टिकल्स
मिले। जिसमें से एटलीस्ट 90% पार्टिकल्स
नैनो पार्टिकल्स थे। फिर कंपनीज़ का भी
स्कैम देखना। कमर्शियल ग्लास बॉटल्स भी
सेफ नहीं है क्योंकि इनमें तो प्लास्टिक
बॉटल से भी एटलीस्ट पांच गुना ज्यादा
माइक्रो प्लास्टिक्स पाए जा रहे हैं। यह
फ्रांस की सेफ्टी एजेंसी बोल रही है
जिन्होंने जस्ट अभी पिछले ही हफ्ते एक
रिसर्च रिपोर्ट पब्लिश की थी कि ये बॉटल्स
तो ग्लास के जरूर होते हैं। मगर उनके कैप
में एक प्लास्टिक पॉलीमर बेस्ड कोटिंग या
पेंट यूज़ होता है जो स्टोरेज के वक्त
स्क्रैच होकर प्लास्टिक रिलीज करता है। एक
और एक गिमिक हम सब चिप्स और नमकीन खाते
हैं। हमें लगता है कि इनके अंदर एलुमिनियम
फॉइल होता है। दिखने में भी ऐसा ही लगता
है। मगर यह मेटलाइज्ड प्लास्टिक फिल्म्स
होते हैं। जिनमें बस एक एक्सट्रीमली पतला
सा एलुमिनियम फॉइल का लेयर होता है और
बाकी का पूरा प्लास्टिक। टेट्रा पैक का भी
सेम ही हाल है। चाहे छह लेयर हो या सात
लेयर। पैकेट वाले मिल्क, पैकेज, ब्रेड्स,
बिस्किट्स, प्रोसेस मीट, कैंड फूड्स यह हर
जगह पर है। एक एवरेज इंसान के दिमाग में
इन टोटल अराउंड 6.5 ग्राम्स प्लास्टिक मिल
रहा है। यानी कि एक पूरे के पूरे क्रेडिट
कार्ड जितना या तीन फुल प्लास्टिक कैप्स,
लिवर, किडनी, ओवरीज, स्टमक, इंटेस्टाइन
में ये इनफ्लेमेशंस और सेल डैमेज तो कॉज
करते ही हैं। मगर नोट दिस, कैंसर का रिस्क
भी बढ़ाते हैं और एकिस्टिंग कैंसरस
ट्यूमर्स के ग्रोथ को भी फास्ट कर देते
हैं। हमारी दुनिया लिटरली प्लास्टिक के
ढेर तले दबी हुई
(Use same fast-paced + fact-driven style)

====================

Topic: "${topic}"

TASK:
Create a MAXIMUM 120 second short video script.

LANGUAGE:
Hinglish + Hindi mix (Indian creator style)

STYLE:
- Curious
- Fast paced
- Storytelling
- Fact + hook based

FORMAT (STRICT):

Timestamp | Script | Visual

RULES:
- Each line = one scene
- 6 to 8 lines only
- Each script line should sound natural while speaking
- No emojis
- No headings
- No explanation
- No markdown
- No extra text

EXAMPLE FORMAT:
0-3s | Kya tum jaante ho...? | Shock face + text pop

Now generate following ALL rules.
`,
  });

  return result.toTextStreamResponse();
}
